{% extends "ui/base.html" %}
{% load static %}

{% block content %}

<!-- Formularz tworzenia -->
<form class="row" hx-post="{% url 'ui:create_task' %}" hx-target="#tasks-body" hx-swap="afterbegin">
  {% csrf_token %}
  <input type="text" name="title" placeholder="Nowy task..." required />
  <select name="project" required>
    <option value="">-- projekt --</option>
    {% for p in projects %}
      <option value="{{ p.id }}">{{ p.name }}</option>
    {% endfor %}
  </select>
  <select name="status">
    <option value="todo">todo</option>
    <option value="inprogress">inprogress</option>
    <option value="done">done</option>
  </select>
  <button class="btn ok" type="submit">Dodaj</button>
</form>

<!-- Filtry -->
<div class="row" style="margin-top:12px;">
  <select id="filter-project" hx-get="{% url 'ui:tasks_table' %}" hx-target="#tasks-table" hx-include="#filter-project,#filter-status">
    <option value="">wszystkie projekty</option>
    {% for p in projects %}
      <option value="{{ p.id }}">{{ p.name }}</option>
    {% endfor %}
  </select>

  <select id="filter-status" hx-get="{% url 'ui:tasks_table' %}" hx-target="#tasks-table" hx-include="#filter-project,#filter-status">
    <option value="">wszystkie statusy</option>
    <option value="todo">todo</option>
    <option value="inprogress">inprogress</option>
    <option value="done">done</option>
  </select>

  <button class="btn" hx-get="{% url 'ui:tasks_table' %}" hx-target="#tasks-table">Odśwież</button>
</div>

<!-- Tabela -->
<div id="tasks-table" hx-get="{% url 'ui:tasks_table' %}" hx-trigger="load">
  <!-- tu wejdzie partial z wierszami -->
</div>

<script>
  document.body.addEventListener('htmx:configRequest', (e) => {
    const csrftoken = '{{ csrf_token }}';  // token z renderu
    if (csrftoken) e.detail.headers['X-CSRFToken'] = csrftoken;
  });
</script>

{% endblock %}
